<%- include('../partials/head.ejs', { title: typeof title !== 'undefined' ? title : 'Men\'s Collection - SOLARA' }) %>

<%- include('../partials/nav.ejs', { currentPage: 'men' }) %>

    <!-- Page Header -->
    <section class="page-hero">
        <div class="container">
            <div class="page-hero-content">
                <h1><%= typeof __ !== 'undefined' ? __("category.mensCollection") : "Men's Collection" %></h1>
                <p><%= typeof __ !== 'undefined' ? __("category.discoverMens") : "Discover our latest men's fashion trends and timeless classics" %></p>
                <nav class="breadcrumb">
                    <a href="/"><%= typeof __ !== 'undefined' ? __("nav.home") : "Home" %></a>
                    <span>/</span>
                    <span><%= typeof __ !== 'undefined' ? __("category.mensCollection") : "Men's Collection" %></span>
                </nav>
            </div>
        </div>
    </section>

    <!-- Filters and Sorting -->
    <section class="filters-section" style="background: white; padding: 2rem 0; border-bottom: 1px solid #eee;">
        <div class="container">
            <div class="filters-container" style="display: flex; gap: 2rem; align-items: flex-end; flex-wrap: wrap; justify-content: center;">
                <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <h3 style="font-size: 0.9rem; font-weight: 600; color: #666; margin: 0; text-transform: uppercase; letter-spacing: 0.5px;"><%= typeof __ !== 'undefined' ? __("filters.filterByCategory") : "Filter by Category" %></h3>
                    <div class="filter-options" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button class="filter-btn subcategory-filter <%= typeof filters !== 'undefined' && filters.subcategory === 'all' ? 'active' : '' %>" data-subcategory="all" style="padding: 0.5rem 1.25rem; border: 2px solid #ddd; background: white; color: #666; border-radius: 6px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; font-weight: 500;"><%= typeof __ !== 'undefined' ? __("filters.allItems") : "All Items" %></button>
                        <button class="filter-btn subcategory-filter <%= typeof filters !== 'undefined' && filters.subcategory === 'tops' ? 'active' : '' %>" data-subcategory="tops" style="padding: 0.5rem 1.25rem; border: 2px solid #ddd; background: white; color: #666; border-radius: 6px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; font-weight: 500;"><%= typeof __ !== 'undefined' ? __("filters.tops") : "Tops" %></button>
                        <button class="filter-btn subcategory-filter <%= typeof filters !== 'undefined' && filters.subcategory === 'pants' ? 'active' : '' %>" data-subcategory="pants" style="padding: 0.5rem 1.25rem; border: 2px solid #ddd; background: white; color: #666; border-radius: 6px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; font-weight: 500;"><%= typeof __ !== 'undefined' ? __("filters.pants") : "Pants" %></button>
                        <button class="filter-btn subcategory-filter <%= typeof filters !== 'undefined' && filters.subcategory === 'shoes' ? 'active' : '' %>" data-subcategory="shoes" style="padding: 0.5rem 1.25rem; border: 2px solid #ddd; background: white; color: #666; border-radius: 6px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; font-weight: 500;"><%= typeof __ !== 'undefined' ? __("filters.shoes") : "Shoes" %></button>
                    </div>
                </div>
                
                <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <h3 style="font-size: 0.9rem; font-weight: 600; color: #666; margin: 0; text-transform: uppercase; letter-spacing: 0.5px;"><%= typeof __ !== 'undefined' ? __("filters.sortBy") : "Sort by" %></h3>
                    <select class="sort-select" id="sort-select" style="padding: 0.5rem 1rem; border: 2px solid #ddd; border-radius: 6px; background: white; font-size: 0.9rem; cursor: pointer; min-width: 180px;">
                        <option value="newest" <%= typeof filters !== 'undefined' && filters.sort === 'newest' ? 'selected' : '' %>><%= typeof __ !== 'undefined' ? __("filters.newestFirst") : "Newest First" %></option>
                        <option value="price-low" <%= typeof filters !== 'undefined' && filters.sort === 'price-low' ? 'selected' : '' %>><%= typeof __ !== 'undefined' ? __("filters.priceLowHigh") : "Price: Low to High" %></option>
                        <option value="price-high" <%= typeof filters !== 'undefined' && filters.sort === 'price-high' ? 'selected' : '' %>><%= typeof __ !== 'undefined' ? __("filters.priceHighLow") : "Price: High to Low" %></option>
                        <option value="name-asc" <%= typeof filters !== 'undefined' && filters.sort === 'name-asc' ? 'selected' : '' %>><%= typeof __ !== 'undefined' ? __("filters.nameAZ") : "Name: A to Z" %></option>
                        <option value="name-desc" <%= typeof filters !== 'undefined' && filters.sort === 'name-desc' ? 'selected' : '' %>><%= typeof __ !== 'undefined' ? __("filters.nameZA") : "Name: Z to A" %></option>
                    </select>
                </div>
                
                <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.75rem; min-width: 200px;">
                    <h3 style="font-size: 0.9rem; font-weight: 600; color: #666; margin: 0; text-transform: uppercase; letter-spacing: 0.5px;"><%= typeof __ !== 'undefined' ? __("filters.priceRange") : "Price Range" %></h3>
                    <div class="price-range" style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <input type="range" id="price-range" min="700" max="5000" value="<%= typeof filters !== 'undefined' && filters.maxPrice ? filters.maxPrice : '5000' %>" step="50" style="width: 100%;">
                        <div class="price-labels" style="display: flex; justify-content: space-between; font-size: 0.85rem; color: #666;">
                            <span>700 EGP</span>
                            <span id="max-price"><%= typeof filters !== 'undefined' && filters.maxPrice ? filters.maxPrice : '5000' %> EGP</span>
                        </div>
                    </div>
                </div>
                
                <% if (typeof filters !== 'undefined' && (filters.subcategory !== 'all' || filters.minPrice || filters.maxPrice)) { %>
                <div class="filter-group" style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <button class="btn btn-outline" id="clear-filters-btn" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                        <i class="fas fa-times"></i> <%= typeof __ !== 'undefined' ? __("filters.clearFilters") : "Clear Filters" %>
                    </button>
                </div>
                <% } %>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products-section">
        <div class="container">
            <div class="section-header">
                <h2><%= typeof __ !== 'undefined' ? __("category.mensFashion") : "Men's Fashion" %></h2>
                <p><%= typeof __ !== 'undefined' ? __("category.showingProducts") : "Showing" %> <span id="product-count"><%= typeof pagination !== 'undefined' ? pagination.totalProducts : 0 %></span> <%= typeof __ !== 'undefined' ? __("category.products") : "products" %></p>
            </div>
            
            <div class="products-grid" id="products-grid">
                <% if (typeof products !== 'undefined' && products.length > 0) { %>
                    <% products.forEach(product => { %>
                        <div class="product-card" data-product-id="<%= product._id %>">
                            <div class="product-image">
                                <% if (product.comparePrice) { %>
                                    <div class="sale-badge"><%= typeof __ !== 'undefined' ? __("home.sale") : "SALE" %></div>
                                <% } %>
                                <img src="<%= product.imageUrl %>" alt="<%= product.name %>" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <div class="image-placeholder" style="display:none;">
                                    <i class="fas fa-image"></i>
                                </div>
                            </div>
                            <div class="product-card-content">
                                <p class="category"><%= product.category.charAt(0).toUpperCase() + product.category.slice(1) %></p>
                                <h3><%= product.name %></h3>
                                <p class="price">EGP <%= product.price.toFixed(2) %></p>
                                <div class="product-actions">
                                    <button class="btn btn-primary btn-add-to-cart" data-product-id="<%= product._id %>">
                                        <i class="fas fa-shopping-cart"></i>
                                        <%= typeof __ !== 'undefined' ? __("product.addToCart") : "Add to Cart" %>
                                    </button>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <div class="empty-state">
                        <i class="fas fa-box-open"></i>
                        <h3>No products found</h3>
                        <p>We're working on adding more men's products. Check back soon!</p>
                    </div>
                <% } %>
            </div>
            
            <% if (typeof pagination !== 'undefined' && pagination.hasMore) { %>
            <div class="load-more-container">
                <button class="btn btn-outline" id="load-more-btn">
                    <i class="fas fa-plus"></i>
                    Load More Products
                </button>
            </div>
            <% } %>
        </div>
    </section>

    <!-- Size Guide Section -->
    <section class="size-guide" style="padding: 4rem 0;">
        <div class="container">
            <h2 style="text-align: center; margin-bottom: 3rem;"><%= typeof __ !== 'undefined' ? __("sizeGuide.mensSizeGuide") : "Men's Size Guide" %></h2>
            <div class="size-guide-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; max-width: 1000px; margin: 0 auto;">
                <div class="size-chart">
                    <h3 style="margin-bottom: 1.5rem;"><%= typeof __ !== 'undefined' ? __("sizeGuide.clothingSizes") : "Clothing Sizes" %></h3>
                    <table class="size-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f5f5f5;">
                                <th style="padding: 1rem; text-align: left; border: 1px solid #ddd;"><%= typeof __ !== 'undefined' ? __("sizeGuide.size") : "Size" %></th>
                                <th style="padding: 1rem; text-align: left; border: 1px solid #ddd;"><%= typeof __ !== 'undefined' ? __("sizeGuide.chest") : "Chest (in)" %></th>
                                <th style="padding: 1rem; text-align: left; border: 1px solid #ddd;"><%= typeof __ !== 'undefined' ? __("sizeGuide.waist") : "Waist (in)" %></th>
                                <th style="padding: 1rem; text-align: left; border: 1px solid #ddd;"><%= typeof __ !== 'undefined' ? __("sizeGuide.height") : "Height (ft)" %></th>
                                <th style="padding: 1rem; text-align: left; border: 1px solid #ddd;"><%= typeof __ !== 'undefined' ? __("sizeGuide.weight") : "Weight (kg)" %></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 1rem; border: 1px solid #ddd;">S</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">34-36</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">28-30</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">5'6"-5'8"</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">59-68</td>
                            </tr>
                            <tr>
                                <td style="padding: 1rem; border: 1px solid #ddd;">M</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">38-40</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">32-34</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">5'8"-5'10"</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">68-77</td>
                            </tr>
                            <tr>
                                <td style="padding: 1rem; border: 1px solid #ddd;">L</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">42-44</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">36-38</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">5'10"-6'0"</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">77-86</td>
                            </tr>
                            <tr>
                                <td style="padding: 1rem; border: 1px solid #ddd;">XL</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">46-48</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">40-42</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">6'0"-6'2"</td>
                                <td style="padding: 1rem; border: 1px solid #ddd;">86-95</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="size-tips">
                    <h3 style="margin-bottom: 1.5rem;"><%= typeof __ !== 'undefined' ? __("sizeGuide.sizeTips") : "Size Tips" %></h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 0.75rem 0; border-bottom: 1px solid #eee;"><%= typeof __ !== 'undefined' ? __("sizeGuide.tip1") : "Measure your chest at the fullest part" %></li>
                        <li style="padding: 0.75rem 0; border-bottom: 1px solid #eee;"><%= typeof __ !== 'undefined' ? __("sizeGuide.tip2") : "Measure your waist at the narrowest point" %></li>
                        <li style="padding: 0.75rem 0; border-bottom: 1px solid #eee;"><%= typeof __ !== 'undefined' ? __("sizeGuide.tip3") : "Consider your preferred fit (slim, regular, relaxed)" %></li>
                        <li style="padding: 0.75rem 0; border-bottom: 1px solid #eee;"><%= typeof __ !== 'undefined' ? __("sizeGuide.tip4") : "Check our detailed size charts for each product" %></li>
                        <li style="padding: 0.75rem 0;"><%= typeof __ !== 'undefined' ? __("sizeGuide.tip5") : "Contact us if you need help with sizing" %></li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Styling Tips Section -->
    <section class="styling-tips" style="padding: 4rem 0; background: #fafafa;">
        <div class="container">
            <h2 style="text-align: center; font-size: 2.5rem; margin-bottom: 3rem; color: #1a1a2e;"><%= typeof __ !== 'undefined' ? __("stylingGuide.mensStylingGuide") : "Men's Styling Guide" %></h2>
            <div class="tips-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; max-width: 1200px; margin: 0 auto;">
                <style>
                    @media (max-width: 768px) {
                        .tips-grid {
                            grid-template-columns: 1fr !important;
                        }
                        .filters-container {
                            flex-direction: column !important;
                            align-items: stretch !important;
                        }
                        .filter-group {
                            width: 100% !important;
                        }
                    }
                </style>
                <div class="tip-card" style="background: white; padding: 2rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: transform 0.3s;">
                    <i class="fas fa-palette" style="font-size: 2.5rem; color: var(--accent-color); margin-bottom: 1rem;"></i>
                    <h3 style="font-size: 1.25rem; margin-bottom: 0.75rem; color: #1a1a2e;"><%= typeof __ !== 'undefined' ? __("stylingGuide.colorCoordination") : "Color Coordination" %></h3>
                    <p style="color: #666; line-height: 1.6;"><%= typeof __ !== 'undefined' ? __("stylingGuide.colorCoordinationDesc") : "Learn how to build a versatile wardrobe with neutral colors and strategic accent pieces" %></p>
                </div>
                <div class="tip-card" style="background: white; padding: 2rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: transform 0.3s;">
                    <i class="fas fa-ruler" style="font-size: 2.5rem; color: var(--accent-color); margin-bottom: 1rem;"></i>
                    <h3 style="font-size: 1.25rem; margin-bottom: 0.75rem; color: #1a1a2e;"><%= typeof __ !== 'undefined' ? __("stylingGuide.perfectFit") : "Perfect Fit" %></h3>
                    <p style="color: #666; line-height: 1.6;"><%= typeof __ !== 'undefined' ? __("stylingGuide.perfectFitDesc") : "Understanding how clothes should fit your body type for maximum style impact" %></p>
                </div>
                <div class="tip-card" style="background: white; padding: 2rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: transform 0.3s;">
                    <i class="fas fa-star" style="font-size: 2.5rem; color: var(--accent-color); margin-bottom: 1rem;"></i>
                    <h3 style="font-size: 1.25rem; margin-bottom: 0.75rem; color: #1a1a2e;"><%= typeof __ !== 'undefined' ? __("stylingGuide.trendingStyles") : "Trending Styles" %></h3>
                    <p style="color: #666; line-height: 1.6;"><%= typeof __ !== 'undefined' ? __("stylingGuide.trendingStylesDesc") : "Stay updated with the latest men's fashion trends and how to incorporate them" %></p>
                </div>
            </div>
        </div>
    </section>

<%- include('../partials/footer.ejs') %>

<style>
    /* Make product cards clickable */
    .product-card {
        cursor: pointer;
        transition: transform 0.2s ease;
    }
    
    .product-card:hover {
        transform: translateY(-4px);
    }
</style>

<script>
    // Helper function to update URL with filters
    function updateFilters() {
        const url = new URL(window.location);
        const subcategory = document.querySelector('.subcategory-filter.active')?.dataset.subcategory || 'all';
        const sort = document.getElementById('sort-select')?.value || 'newest';
        const maxPrice = document.getElementById('price-range')?.value || '';
        
        // Update URL params
        if (subcategory && subcategory !== 'all') {
            url.searchParams.set('subcategory', subcategory);
        } else {
            url.searchParams.delete('subcategory');
        }
        
        if (sort && sort !== 'newest') {
            url.searchParams.set('sort', sort);
        } else {
            url.searchParams.delete('sort');
        }
        
        if (maxPrice && maxPrice !== '5000') {
            url.searchParams.set('maxPrice', maxPrice);
        } else {
            url.searchParams.delete('maxPrice');
        }
        
        // Reset to page 1 when filters change
        url.searchParams.set('page', '1');
        
        // Reload page with new filters
        window.location.href = url.toString();
    }
    
    // Page-specific initialization for Men's collection
    document.addEventListener('DOMContentLoaded', function() {
        // Setup product card click handlers using event delegation
        document.addEventListener('click', function(e) {
            const productCard = e.target.closest('.product-card');
            if (productCard && !e.target.closest('button') && !e.target.closest('.btn')) {
                const productId = productCard.dataset.productId;
                if (productId) {
                    window.location.href = `/product/${productId}`;
                }
            }
        });
        
        // Setup subcategory filter buttons
        document.querySelectorAll('.subcategory-filter').forEach(btn => {
            btn.addEventListener('click', function() {
                // Update active state
                document.querySelectorAll('.subcategory-filter').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Update URL and reload
                updateFilters();
            });
        });
        
        // Setup sort dropdown
        const sortSelect = document.getElementById('sort-select');
        if (sortSelect) {
            sortSelect.addEventListener('change', function() {
                updateFilters();
            });
        }
        
        // Setup price range slider
        const priceRange = document.getElementById('price-range');
        const maxPriceDisplay = document.getElementById('max-price');
        if (priceRange && maxPriceDisplay) {
            // Update display on input
            priceRange.addEventListener('input', function() {
                maxPriceDisplay.textContent = this.value + ' EGP';
            });
            
            // Update URL on change (with debounce)
            let priceTimeout;
            priceRange.addEventListener('change', function() {
                clearTimeout(priceTimeout);
                priceTimeout = setTimeout(() => {
                    updateFilters();
                }, 500);
            });
        }
        
        // Setup clear filters button
        const clearFiltersBtn = document.getElementById('clear-filters-btn');
        if (clearFiltersBtn) {
            clearFiltersBtn.addEventListener('click', function() {
                window.location.href = '/men';
            });
        }
        
        // Setup Load More button to maintain filter state
        const loadMoreBtn = document.getElementById('load-more-btn');
        if (loadMoreBtn) {
            loadMoreBtn.addEventListener('click', function() {
                const url = new URL(window.location);
                const currentPage = parseInt(url.searchParams.get('page') || '1');
                url.searchParams.set('page', (currentPage + 1).toString());
                window.location.href = url.toString();
            });
        }
        
        // Update filter button styles
        document.querySelectorAll('.subcategory-filter').forEach(btn => {
            if (btn.classList.contains('active')) {
                btn.style.borderColor = 'var(--accent-color)';
                btn.style.background = 'var(--accent-color)';
                btn.style.color = 'white';
            } else {
                btn.style.borderColor = '#ddd';
                btn.style.background = 'white';
                btn.style.color = '#666';
            }
        });
        
        // Also call the existing function if available (for AJAX-loaded products)
        if (typeof setupProductCardEvents === 'function') {
            setupProductCardEvents();
        }
    });
</script>


